<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Drew Day" />

<meta name="date" content="2023-12-03" />

<title>How to use the impgrplasso package</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>
<script>$(document).ready(function(){
    if (typeof $('[data-toggle="tooltip"]').tooltip === 'function') {
        $('[data-toggle="tooltip"]').tooltip();
    }
    if ($('[data-toggle="popover"]').popover === 'function') {
        $('[data-toggle="popover"]').popover();
    }
});
</script>
<style type="text/css">
.lightable-minimal {
border-collapse: separate;
border-spacing: 16px 1px;
width: 100%;
margin-bottom: 10px;
}
.lightable-minimal td {
margin-left: 5px;
margin-right: 5px;
}
.lightable-minimal th {
margin-left: 5px;
margin-right: 5px;
}
.lightable-minimal thead tr:last-child th {
border-bottom: 2px solid #00000050;
empty-cells: hide;
}
.lightable-minimal tbody tr:first-child td {
padding-top: 0.5em;
}
.lightable-minimal.lightable-hover tbody tr:hover {
background-color: #f5f5f5;
}
.lightable-minimal.lightable-striped tbody tr:nth-child(even) {
background-color: #f5f5f5;
}
.lightable-classic {
border-top: 0.16em solid #111111;
border-bottom: 0.16em solid #111111;
width: 100%;
margin-bottom: 10px;
margin: 10px 5px;
}
.lightable-classic tfoot tr td {
border: 0;
}
.lightable-classic tfoot tr:first-child td {
border-top: 0.14em solid #111111;
}
.lightable-classic caption {
color: #222222;
}
.lightable-classic td {
padding-left: 5px;
padding-right: 5px;
color: #222222;
}
.lightable-classic th {
padding-left: 5px;
padding-right: 5px;
font-weight: normal;
color: #222222;
}
.lightable-classic thead tr:last-child th {
border-bottom: 0.10em solid #111111;
}
.lightable-classic.lightable-hover tbody tr:hover {
background-color: #F9EEC1;
}
.lightable-classic.lightable-striped tbody tr:nth-child(even) {
background-color: #f5f5f5;
}
.lightable-classic-2 {
border-top: 3px double #111111;
border-bottom: 3px double #111111;
width: 100%;
margin-bottom: 10px;
}
.lightable-classic-2 tfoot tr td {
border: 0;
}
.lightable-classic-2 tfoot tr:first-child td {
border-top: 3px double #111111;
}
.lightable-classic-2 caption {
color: #222222;
}
.lightable-classic-2 td {
padding-left: 5px;
padding-right: 5px;
color: #222222;
}
.lightable-classic-2 th {
padding-left: 5px;
padding-right: 5px;
font-weight: normal;
color: #222222;
}
.lightable-classic-2 tbody tr:last-child td {
border-bottom: 3px double #111111;
}
.lightable-classic-2 thead tr:last-child th {
border-bottom: 1px solid #111111;
}
.lightable-classic-2.lightable-hover tbody tr:hover {
background-color: #F9EEC1;
}
.lightable-classic-2.lightable-striped tbody tr:nth-child(even) {
background-color: #f5f5f5;
}
.lightable-material {
min-width: 100%;
white-space: nowrap;
table-layout: fixed;
font-family: Roboto, sans-serif;
border: 1px solid #EEE;
border-collapse: collapse;
margin-bottom: 10px;
}
.lightable-material tfoot tr td {
border: 0;
}
.lightable-material tfoot tr:first-child td {
border-top: 1px solid #EEE;
}
.lightable-material th {
height: 56px;
padding-left: 16px;
padding-right: 16px;
}
.lightable-material td {
height: 52px;
padding-left: 16px;
padding-right: 16px;
border-top: 1px solid #eeeeee;
}
.lightable-material.lightable-hover tbody tr:hover {
background-color: #f5f5f5;
}
.lightable-material.lightable-striped tbody tr:nth-child(even) {
background-color: #f5f5f5;
}
.lightable-material.lightable-striped tbody td {
border: 0;
}
.lightable-material.lightable-striped thead tr:last-child th {
border-bottom: 1px solid #ddd;
}
.lightable-material-dark {
min-width: 100%;
white-space: nowrap;
table-layout: fixed;
font-family: Roboto, sans-serif;
border: 1px solid #FFFFFF12;
border-collapse: collapse;
margin-bottom: 10px;
background-color: #363640;
}
.lightable-material-dark tfoot tr td {
border: 0;
}
.lightable-material-dark tfoot tr:first-child td {
border-top: 1px solid #FFFFFF12;
}
.lightable-material-dark th {
height: 56px;
padding-left: 16px;
padding-right: 16px;
color: #FFFFFF60;
}
.lightable-material-dark td {
height: 52px;
padding-left: 16px;
padding-right: 16px;
color: #FFFFFF;
border-top: 1px solid #FFFFFF12;
}
.lightable-material-dark.lightable-hover tbody tr:hover {
background-color: #FFFFFF12;
}
.lightable-material-dark.lightable-striped tbody tr:nth-child(even) {
background-color: #FFFFFF12;
}
.lightable-material-dark.lightable-striped tbody td {
border: 0;
}
.lightable-material-dark.lightable-striped thead tr:last-child th {
border-bottom: 1px solid #FFFFFF12;
}
.lightable-paper {
width: 100%;
margin-bottom: 10px;
color: #444;
}
.lightable-paper tfoot tr td {
border: 0;
}
.lightable-paper tfoot tr:first-child td {
border-top: 1px solid #00000020;
}
.lightable-paper thead tr:last-child th {
color: #666;
vertical-align: bottom;
border-bottom: 1px solid #00000020;
line-height: 1.15em;
padding: 10px 5px;
}
.lightable-paper td {
vertical-align: middle;
border-bottom: 1px solid #00000010;
line-height: 1.15em;
padding: 7px 5px;
}
.lightable-paper.lightable-hover tbody tr:hover {
background-color: #F9EEC1;
}
.lightable-paper.lightable-striped tbody tr:nth-child(even) {
background-color: #00000008;
}
.lightable-paper.lightable-striped tbody td {
border: 0;
}
</style>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">How to use the impgrplasso package</h1>
<h4 class="author">Drew Day</h4>
<h4 class="date">12/03/2023</h4>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>Least Absolute Shrinkage and Selection Operator (LASSO) regression is
a statistical technique to impose penalties on independent variables in
a regression in order to produce a more sparse model to improve
out-of-sample prediction as well as to enhance the interpretability of
the model. The L1 penalty of the LASSO model can shrink independent
variables to zero, in effect removing them from regression models. There
is no clear way of defining traditional frequentist error estimates
(i.e., confidence intervals and p-values) for the coefficient estimates
in a LASSO regression model since any null distribution for a given
independent variable would inevitably result in some models omitting
that variable and others not. For this same reason, traditional
approaches for combining regression estimates from multiply imputed data
do not apply to LASSO regression.</p>
<p>Multiple imputation is a series of methods for imputing multiple
potential values for a missing observation, often based on a probability
distribution that is predicted by the other independent and dependent
variables to be used in a regression incorporating that variable with
missingness. Multiple imputation with chained equations (MICE) is a
well-established multiple imputation method that begins by imputing the
mean for each missing value of each variable with missingness except for
one, using the now “complete” data of other variables to predict values
using regression models for the missing values in that selected variable
and then use those as imputed values in the next regression imputing
values for the next variable, and so on in several iterations of chained
regressions. For more explanation see <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3074241/">Azur et
al. 2011</a>.</p>
<p>The goal of this package is to adapt one of several suggested methods
for combining multiple imputation and LASSO regression, namely the
MI-LASSO method of <a href="https://onlinelibrary.wiley.com/doi/10.1002/sim.5783">Chen and
Wang 2013</a>, which stacks imputed data sets and then uses a group
LASSO penalty to jointly penalize each imputed version of a given
independent variable. The ‘impgrplasso’ package builds off of this
method, which provided the best combination of interpretability and low
prediction error in the comparative simulation study of <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10117422/">Gunn et
al. 2023</a>, by incorporating the following additional features:</p>
<ul>
<li>The use of a prediction loss measure for optimizing the lambda
parameter as suggested by Gunn et al. 2023 rather than using the Bayes
Information Criterion (BIC), adding a log-loss measure for LASSO
logistic regression prediction error to the mean squared prediction
error (MSE) proposed by Gunn et al. in the case of LASSO standard
regression</li>
<li>The incorporation of k-fold cross validation to optimize lambda
rather than single training/test splits</li>
<li>The incorporation of the established <a href="https://CRAN.R-project.org/package=grplasso">‘grplasso’</a>
package (<a href="https://rss.onlinelibrary.wiley.com/doi/10.1111/j.1467-9868.2007.00627.x">Meier
et al. 2008</a>) for computing group LASSO penalties</li>
<li>The option to not penalize a subset of independent variables in the
LASSO regression</li>
<li>Automatic detection of dummy variables from the same categorical
variable and the application of a group LASSO penalty to those
variables</li>
</ul>
<div id="about-lasso-regression" class="section level2">
<h2>About LASSO Regression</h2>
<p>Standard LASSO regression minimizes the loss function below:</p>
<p><span class="math display">\[
\sum_{i=1}^{N}{(y_i-[\beta_0+\sum_{j=1}^{p}{\beta_j x_{ij}]})^2} +
\lambda \sum_{j=1}^{p}{\left\lvert{\beta_j}\right\lvert}
\]</span></p>
<p>Notice how the formula to the left of the addition sign is just the
function that an ordinary least squares (OLS) regression minimizes
(i.e., the sum of the squared residuals). The right of the addition sign
is the penalization term, which is the sum of the absolute values of all
independent variable coefficients <span class="math inline">\(\beta_j\)</span> scaled by the parameter <span class="math inline">\(\lambda\)</span>.</p>
</div>
<div id="about-mi-lasso" class="section level2">
<h2>About MI-LASSO</h2>
<p>The Chen and Wang 2013 MI-LASSO approach to LASSO regression for
multiply imputed data minimizes the similar function below:</p>
<p><span class="math display">\[
\sum_{d=1}^{m}{\sum_{i=1}^{N}{(y_{di}-[\beta_{0d}+\sum_{j=1}^{p}{\beta_{dj}
x_{dij}}])^2}} + \lambda
\sum_{j=1}^{p}\sqrt{\sum_{d=1}^{m}{\beta^2_{dj}}}
\]</span></p>
<p>Here the loss function is being summed over <span class="math inline">\(m\)</span> imputed data sets. In practice, we
stack the imputed data sets into a model matrix in a diagonal fashion,
such that each imputed version of a variable gets a unique column and
there are columns of ones for each imputed data set-specific intercept.
Then the rows are the observations repeated <span class="math inline">\(m\)</span> times with zero values for all but the
relevant <span class="math inline">\(d\)</span>th column for each
variable. As an example, let’s say I have 3 observations and 2 variables
(<span class="math inline">\(X1\)</span> and <span class="math inline">\(X2\)</span>) with two imputed data sets. <span class="math inline">\(X1\)</span> is continuous, but <span class="math inline">\(X2\)</span> is categorical and has three levels,
meaning that two dummy variables will be generated (the referent level
is omitted). Using the vertical bar to denote the imputed version of
each variable and the underscore to denote levels of a categorical
variable, I will get the following model matrix:</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
ID
</th>
<th style="text-align:right;">
beta0|1
</th>
<th style="text-align:right;">
X1|1
</th>
<th style="text-align:right;">
X2_Level1|1
</th>
<th style="text-align:right;">
X2_Level2|1
</th>
<th style="text-align:right;">
beta0|2
</th>
<th style="text-align:right;">
X1|2
</th>
<th style="text-align:right;">
X2_Level1|2
</th>
<th style="text-align:right;">
X2_Level2|2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
ID1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6.5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
ID2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
ID3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3.3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
ID1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5.9
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
ID2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
ID3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3.1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>The parameter <span class="math inline">\(\lambda\)</span> has to be
chosen a priori before each model run, and as <span class="math inline">\(\lambda\)</span> increases, the degree of
penalization increases. Using k-fold cross- validation, a <span class="math inline">\(\lambda\)</span> value that minimizes
out-of-sample prediction loss function can be determined. The range of
possible <span class="math inline">\(\lambda\)</span> will be higher
than for a typical LASSO regression because of the high number of
imputed columns and the group LASSO penalty between them.</p>
</div>
</div>
<div id="how-to-use-the-impgrplasso-package" class="section level1">
<h1>How to use the <code>impgrplasso</code> package</h1>
<p>To use <code>impgrplasso</code>, we must first generate a list of
imputed data frames. This can be done for example using the
<code>mice</code> function from the ‘mice’ package or using the function
<code>mice_by_group</code> from this package. The list of data frames
must have all categorical columns transformed into dummy variables. This
can either be done beforehand or the user can set the argument ‘dummify’
to TRUE (the default), in which case the function will do that
transformation. Note that for proper functioning, variable names should
not contain underscores (“_“) so that when the dummy variables are
generated, an underscore can be added by <code>impgrplasso</code> to
separate the variable name (before the added underscore) from its
respective levels (after the added underscore).</p>
<p>In this example, we will use MICE and create a list of imputed data
frames using the <code>nhanes</code> example data frame included in the
‘mice’ package.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mice)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Attaching package: &#39;mice&#39;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; The following object is masked from &#39;package:stats&#39;:</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     filter</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; The following objects are masked from &#39;package:base&#39;:</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     cbind, rbind</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>nh <span class="ot">&lt;-</span> nhanes</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>nh<span class="sc">$</span>hyp <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(nh<span class="sc">$</span>hyp <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># above brings &quot;hyp&quot; from a {1, 2} set of unique values to {0, 1}</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>imp <span class="ot">&lt;-</span> <span class="fu">mice</span>(nh, <span class="at">printFlag =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>dlist <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span>imp<span class="sc">$</span>m, <span class="cf">function</span>(x) <span class="fu">complete</span>(imp, x))</span></code></pre></div>
<div id="mice_by_group" class="section level2">
<h2>mice_by_group</h2>
<p>Another option is to use the function <code>mice_by_group</code> to
generate group-specific imputed data, for example for imputing within
study cohorts or study sites in a multi-cohort study.</p>
<div id="arguments" class="section level3">
<h3>Arguments</h3>
<ul>
<li><code>Data</code>: A data frame containing all variables (columns)
to be used in the MICE equations and a column with the grouping
variable.</li>
<li><code>groupvar</code>: The column name in <code>Data</code> for the
grouping variable. If this column is not of the class ‘factor’, it will
be converted to a factor with the default order of factor levels.</li>
<li><code>miceArgs</code>: These are arguments to be passed on to the
<code>mice</code> function from the ‘mice’ package. These include the
number of imputed data frames to be generated <code>m</code> (default =
10), the maximum number of MICE iterations <code>maxit</code> (default =
10), a random seed to be set for the MICE for reproducibility
<code>seed</code> (default = 123), and a Boolean option for verbose
printing <code>printFlag</code> (default = FALSE). All other
<code>mice</code> function arguments default to the same values as in
the ‘mice’ package (see <code>?mice::mice</code> for details). Note that
the default <code>m</code> and <code>maxit</code> for <code>mice</code>
are both 5, though I set them to 10 for this function for more
iterations and better convergence, respectively.</li>
</ul>
</div>
<div id="outputs" class="section level3">
<h3>Outputs</h3>
<p>The output of <code>mice_by_group</code> is a list of imputed data
frames.</p>
</div>
<div id="examples" class="section level3">
<h3>Examples</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mice)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(impgrplasso)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>nh<span class="sc">$</span>Group <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">13</span>)))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>dlist2 <span class="ot">&lt;-</span>  <span class="fu">mice_by_group</span>(nh, <span class="st">&quot;Group&quot;</span>, <span class="fu">list</span>(<span class="at">m=</span><span class="dv">5</span>, <span class="at">maxit=</span><span class="dv">5</span>, <span class="at">seed=</span><span class="dv">2</span>, <span class="at">printFlag=</span>F))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in `[&lt;-.data.frame`(`*tmp*`, , sapply(tmpdat, is.factor), value =</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; list(: provided 12 variables to replace 1 variables</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: Number of logged events: 1</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in `[&lt;-.data.frame`(`*tmp*`, , sapply(tmpdat, is.factor), value =</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; list(: provided 13 variables to replace 1 variables</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: Number of logged events: 1</span></span></code></pre></div>
</div>
</div>
<div id="impgrplasso" class="section level2">
<h2>impgrplasso</h2>
<p>Now that we have a list of imputed data frames, we can use
impgrplasso.</p>
<div id="arguments-1" class="section level3">
<h3>Arguments</h3>
<ul>
<li><code>impdatlist</code>: A list of data frames generated by multiple
imputation.</li>
<li><code>lams</code>: Either a single lambda value or a vector of
lambda values. If one value is provided, the function will perform the
MI-LASSO on the full data using only that single lambda value. If a
vector of values is provided, the function will perform cross-validation
to obtain fold- and imputation-specific as well as averaged loss values
and coefficients for each lambda value so that an optimal lambda can be
chosen.</li>
<li><code>outname</code>: A column name for the dependent variable. This
can be continuous or binary. In the case of the latter, a LASSO logistic
regression will be performed.</li>
<li><code>prednames</code>: Column names for the independent variables.
These should be free of underscores. If dummy variables have already
been made for the list of data frames <code>impdatlist</code>, provide
those names with underscores between the variable name and the level
(e.g., “sex_male”).</li>
<li><code>forcedin</code>: This is an optional vector of column names
that should be a subset of <code>prednames</code> that identifies
unpenalized variables to be “forced in” to the model due to them not
experiencing any shrinkage.</li>
<li><code>kfolds</code>: If a vector of lambda values is provided for
the argument <code>lams</code>, <code>kfolds</code> provides the number
of cross-validation folds for the cross-validation process. This
defaults to 10.</li>
<li><code>kfoldseed</code>: The rows chosen for each k-fold
cross-validation are randomly selected once at the beginning of the
function and then this selection is used consistently throughout
subsequent steps. This value sets a seed for that random process. This
defaults to 10.</li>
<li><code>scalecenter</code>: If TRUE (default), the function will scale
and center all variables prior to calculations by subtracting the means
of each variable and dividing by the standard deviations. This is
recommended for LASSO regression, but one can also perform their own
form of standardization in the list of data frames and set this to FALSE
if they prefer another standardization approach.</li>
<li><code>dummify</code>: If TRUE (default), the function will produce
dummy variables for all variables in <code>prednames</code> of classes
‘factor’ or ‘character’. This can be set to FALSE if one wants to create
dummy variables ahead of time and include them in the list of data
frames <code>impdatlist</code>.</li>
</ul>
</div>
<div id="outputs-1" class="section level3">
<h3>Outputs</h3>
<p><code>impgrplasso</code> outputs a list of class ‘impgrplasso’ with
the following items:</p>
<ul>
<li><code>Coef</code>: If <code>lams</code> is a vector, this is a list
of fold-specific data frames containing coefficients for each variable
for specific imputed data frames and lambda values. If <code>lams</code>
is a single value, this is a single data frame with variable- and
imputation-specific coefficients.</li>
<li><code>MeanCoef</code>: If <code>lams</code> is a vector of length
&gt; 1, this is a data frame of mean coefficients across imputed data
frames for each variable at each fold and lambda value. If
<code>lams</code> is a single value, this is a data frame with mean
coefficients across imputed data frames for each variable.</li>
<li><code>Loss</code>: This appears only if <code>lams</code> is a
vector of length &gt; 1, and it is a data frame showing fold- and
imputation-specific loss values and means for each value of lambda.</li>
<li><code>MeanLoss</code>: This appears only if <code>lams</code> is a
vector of length &gt; 1, and it is a data frame showing the mean
prediction loss for each lambda value.</li>
<li><code>Model</code>: This appears only if <code>lams</code> is a
single value, and it is the grplasso model object run on the full
data.</li>
<li><code>Index</code>: This is the index argument for the grplasso
function generated by impgrplasso.</li>
<li><code>allX</code>: This appears only if <code>lams</code> is a
single value, and it is the large stacked matrix of independent
variables across imputed data frames generated by
<code>impgrplasso</code>.</li>
</ul>
<p>A summary method is available for this output, either providing the
average prediction loss per lambda value if multiple lambda values were
input or the LASSO regression coefficients averaged over imputed data
sets if one lambda value was input.</p>
</div>
<div id="examples-1" class="section level3">
<h3>Examples</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Searching for the best lambda</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>multiple_milasso <span class="ot">&lt;-</span> <span class="fu">impgrplasso</span>(<span class="at">impdatlist =</span> dlist, <span class="at">lams =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">2</span>), </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="at">outname =</span> <span class="st">&quot;hyp&quot;</span>, <span class="at">prednames =</span> <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;bmi&quot;</span>, <span class="st">&quot;chl&quot;</span>), <span class="at">forcedin =</span> <span class="st">&quot;age&quot;</span>, </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="at">kfolds =</span> <span class="dv">4</span>, <span class="at">kfoldseed =</span> <span class="dv">12</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Fold 1&quot;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in grplasso.default(x = allX, y = tmpyorig, index = grpl_index, :</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Penalization not adjusted to non-penalized predictors.</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 1  nr.var: 15</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in grplasso.default(x = allX, y = tmpyorig, index = grpl_index, :</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Penalization not adjusted to non-penalized predictors.</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 3  nr.var: 10</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in grplasso.default(x = allX, y = tmpyorig, index = grpl_index, :</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Penalization not adjusted to non-penalized predictors.</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 5  nr.var: 10 </span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Fold 2&quot;</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in grplasso.default(x = allX, y = tmpyorig, index = grpl_index, :</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Penalization not adjusted to non-penalized predictors.</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 1  nr.var: 15</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in grplasso.default(x = allX, y = tmpyorig, index = grpl_index, :</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Penalization not adjusted to non-penalized predictors.</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 3  nr.var: 10</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in grplasso.default(x = allX, y = tmpyorig, index = grpl_index, :</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Penalization not adjusted to non-penalized predictors.</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 5  nr.var: 10 </span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Fold 3&quot;</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in grplasso.default(x = allX, y = tmpyorig, index = grpl_index, :</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Penalization not adjusted to non-penalized predictors.</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 1  nr.var: 15</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in grplasso.default(x = allX, y = tmpyorig, index = grpl_index, :</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Penalization not adjusted to non-penalized predictors.</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 3  nr.var: 10</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in grplasso.default(x = allX, y = tmpyorig, index = grpl_index, :</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Penalization not adjusted to non-penalized predictors.</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 5  nr.var: 10 </span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Fold 4&quot;</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in grplasso.default(x = allX, y = tmpyorig, index = grpl_index, :</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Penalization not adjusted to non-penalized predictors.</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 1  nr.var: 15</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in grplasso.default(x = allX, y = tmpyorig, index = grpl_index, :</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Penalization not adjusted to non-penalized predictors.</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 3  nr.var: 10</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in grplasso.default(x = allX, y = tmpyorig, index = grpl_index, :</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Penalization not adjusted to non-penalized predictors.</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 5  nr.var: 10</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(multiple_milasso)</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Mean prediction loss by lambda:</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         1         3         5 </span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.7588964 0.7203546 0.7203546</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Single Run</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>singlerun_milasso <span class="ot">&lt;-</span> <span class="fu">impgrplasso</span>(dlist, <span class="dv">3</span>, <span class="st">&quot;hyp&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;bmi&quot;</span>, <span class="st">&quot;chl&quot;</span>), <span class="st">&quot;age&quot;</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in grplasso.default(x = allX, y = yvec, index = grpl_index, lambda =</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; lams[1], : Penalization not adjusted to non-penalized predictors.</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 3  nr.var: 10</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(singlerun_milasso)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Mean LASSO regression coefficients:</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     beta0       age       bmi       chl </span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; -2.167375  1.358736  0.000000  0.000000</span></span></code></pre></div>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
